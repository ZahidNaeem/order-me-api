<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet author="Zahid Naeem" id="create-sequence-hibernate_sequence">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="hibernate_sequence"/>
            </not>
        </preConditions>
        <comment>Creating sequence hibernate_sequence</comment>
        <createSequence sequenceName="hibernate_sequence"
                        schemaName="om"
                        startValue="1"
                        incrementBy="1"/>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-country_codes">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="country_codes"/>
            </not>
        </preConditions>
        <comment>Creating table country_codes</comment>
        <createTable schemaName="om" tableName="country_codes">
            <column name="COUNTRY_ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="country_codes_pk"/>
            </column>
            <column name="COUNTRY" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="COUNTRY_CODES_COUNTRY_NN"
                             uniqueConstraintName="country_codes_uk1" unique="true"/>
            </column>
            <column name="ALPHA2_CODE" type="VARCHAR(2)">
                <constraints nullable="false" notNullConstraintName="COUNTRY_CODES_ALPHA2_NN"/>
            </column>
            <column name="ALPHA3_CODE" type="VARCHAR(3)"/>
            <column name="CAPITAL_CITY" type="VARCHAR(50)"/>
            <column name="DIALING_CODE" type="VARCHAR(10)">
                <constraints nullable="false" notNullConstraintName="COUNTRY_CODES_DIALING_CODE_NN"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-banks">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="banks"/>
            </not>
        </preConditions>
        <comment>Creating table banks</comment>
        <createTable schemaName="om" tableName="banks">
            <column name="BANK_ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="banks_pk"/>
            </column>
            <column name="BANK" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="BANKS_BANK_NN"
                             uniqueConstraintName="banks_uk1" unique="true"/>
            </column>
            <column name="LOGO" type="VARCHAR(50)">
                <constraints uniqueConstraintName="banks_uk2" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-main_categories">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="main_categories"/>
            </not>
        </preConditions>
        <comment>Creating table main_categories</comment>
        <createTable schemaName="om" tableName="main_categories">
            <column name="MAIN_CAT_ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="main_categories_pk"/>
            </column>
            <column name="MAIN_CAT_NAME" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="MAIN_CAT_NAME_NN"
                             unique="true" uniqueConstraintName="main_categories_uk1"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-sub_categories">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sub_categories"/>
            </not>
        </preConditions>
        <comment>Creating table sub_categories</comment>
        <createTable schemaName="om" tableName="sub_categories">
            <column name="SUB_CAT_ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="sub_categories_pk"/>
            </column>
            <column name="SUB_CAT_NAME" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="SUB_CAT_NAME_NN"
                             unique="true" uniqueConstraintName="sub_categories_uk1"/>
            </column>
            <column name="MAIN_CAT_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="SUB_CATEGORIES_MAIN_CAT_ID_NN"
                             foreignKeyName="SUB_CATEGORIES_MAIN_CAT_ID_FK"
                             references="main_categories(main_cat_id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-roles">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>
        <comment>Creating table Roles</comment>
        <createTable schemaName="om" tableName="roles">
            <column name="ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="roles_pk"/>
            </column>
            <column name="NAME" type="VARCHAR(20)">
                <constraints nullable="false" notNullConstraintName="ROLES_NAME_NN"
                             unique="true" uniqueConstraintName="roles_name_uk"/>
            </column>
            <column name="CREATED_BY" type="INT"/>
            <column name="CREATION_DATE" type="TIMESTAMP"/>
            <column name="LAST_UPDATED_BY" type="INT"/>
            <column name="LAST_UPDATE_DATE" type="TIMESTAMP"/>
        </createTable>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-users">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <comment>Creating table Users</comment>
        <createTable schemaName="om" tableName="users">
            <column name="ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="users_pk"/>
            </column>
            <column name="FIRST_NAME" type="VARCHAR(20)">
                <constraints nullable="false" notNullConstraintName="USERS_FIRST_NAME_NN"/>
            </column>
            <column name="MIDDLE_NAME" type="VARCHAR(20)">
            </column>
            <column name="LAST_NAME" type="VARCHAR(20)"/>
            <column name="COUNTRY_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="USERS_COUNTRY_ID_NN"
                             foreignKeyName="USERS_COUNTRY_ID_FK"
                             references="country_codes(country_id)"/>
            </column>
            <column name="PHONE" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="USERS_PHONE_NN"
                             unique="true" uniqueConstraintName="users_phone_uk"/>
            </column>
            <column name="EMAIL" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="USERS_EMAIL_NN"
                             unique="true" uniqueConstraintName="users_email_uk"/>
            </column>
            <column name="ADDRESS" type="VARCHAR(500)">
                <constraints nullable="false" notNullConstraintName="USERS_ADDRESS_NN"/>
            </column>
            <column name="BRANCH_NAME" type="VARCHAR(100)"/>
            <column name="FREE_DELIVERY_RADIUS_KM" type="INT"/>
            <column name="PAID_DELIVERY_RADIUS_KM" type="INT"/>
            <column name="DELIVERY_CHARGES" type="INT"/>
<!--            <column name="DELIVERY_CHARGES" type="INT"/>-->
            <column name="AVG_DELIVERY_MINUTES" type="INT"/>
            <column name="USERNAME" type="VARCHAR(50)">
                <constraints nullable="false" notNullConstraintName="USERS_USERNAME_NN"
                             unique="true" uniqueConstraintName="users_username_uk"/>
            </column>
            <column name="PASSWORD" type="VARCHAR(100)">
                <constraints nullable="false" notNullConstraintName="USERS_PASSWORD_NN"/>
            </column>
            <column name="BANK_ID" type="INT">
                <constraints foreignKeyName="USERS_BANK_ID_FK"
                             references="banks(bank_id)"/>
            </column>
            <column name="BANK_ACCOUNT_NO" type="VARCHAR(24)"/>
            <column name="CREDIT_CARD_NO" type="VARCHAR(50)"/>
            <column name="CC_EXPIRY_DATE" type="DATE"/>
            <column name="CVC" type="VARCHAR(10)"/>
            <column name="USER_TYPE" type="VARCHAR(20)">
                <constraints nullable="false" notNullConstraintName="USERS_USER_TYPE_NN"/>
            </column>
            <column name="ACTIVATION_STATUS" type="VARCHAR(20)">
                <constraints nullable="false" notNullConstraintName="USERS_ACTIVATION_STATUS_NN"/>
            </column>
            <column name="REMARKS" type="VARCHAR(2000)"/>
            <column name="CREATED_BY" type="INT"/>
            <column name="CREATION_DATE" type="TIMESTAMP"/>
            <column name="LAST_UPDATED_BY" type="INT"/>
            <column name="LAST_UPDATE_DATE" type="TIMESTAMP"/>
        </createTable>
        <addUniqueConstraint tableName="users" columnNames="FIRST_NAME, BRANCH_NAME" constraintName="users_uk1"/>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-user_roles">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_roles"/>
            </not>
        </preConditions>
        <comment>Creating table User_Roles</comment>
        <createTable schemaName="om" tableName="user_roles">
            <column name="USER_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="USER_ROLES_USER_ID_NN"
                             foreignKeyName="USER_ROLES_USER_ID_FK"
                             references="users(id)"/>
            </column>
            <column name="ROLE_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="USER_ROLES_ROLE_ID_NN"
                             foreignKeyName="USER_ROLES_ROLE_ID_FK"
                             references="roles(id)"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="USER_ID, ROLE_ID" constraintName="USER_ROLES_PK" schemaName="om"
                       tableName="user_roles"/>
    </changeSet>
    <changeSet author="Zahid Naeem" id="create-table-user_main_categories">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_main_categories"/>
            </not>
        </preConditions>
        <comment>Creating table user_main_categories</comment>
        <createTable schemaName="om" tableName="user_main_categories">
            <column name="ID" type="INT">
                <constraints primaryKey="true" primaryKeyName="user_main_categories_pk"/>
            </column>
            <column name="USER_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="USR_MAIN_CATS_USR_ID_NN"
                             foreignKeyName="USR_MAIN_CATS_USR_ID_FK"
                             references="users(id)"/>
            </column>
            <column name="MAIN_CAT_ID" type="INT">
                <constraints nullable="false" notNullConstraintName="USR_MAIN_CATS_MAIN_CAT_NN"
                             foreignKeyName="USR_MAIN_CATS_MAIN_CAT_FK"
                             references="main_categories(main_cat_id)"/>
            </column>
            <column name="CREATED_BY" type="INT"/>
            <column name="CREATION_DATE" type="TIMESTAMP"/>
            <column name="LAST_UPDATED_BY" type="INT"/>
            <column name="LAST_UPDATE_DATE" type="TIMESTAMP"/>
        </createTable>
        <addUniqueConstraint constraintName="user_main_categories_uk1" tableName="user_main_categories"
                             columnNames="USER_ID, MAIN_CAT_ID"/>
    </changeSet>
</databaseChangeLog>
